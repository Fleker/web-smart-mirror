<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Smart Mirror</title>
        <style>
            body {
                background-color: black;
                color: #dedede;
                font-family: sans-serif;
            }
            h1, h2, div {
                text-align: right;
                display: block;
                margin-right:8px;
            }
            h1 {
                font-size:50pt;
            }
            h2 {
                font-size:34pt;   
            }
            div {
                font-size:36pt;   
            }
        </style>
        <script src='https://code.jquery.com/jquery-3.1.1.min.js'></script>
        <script src='NoSleep.min.js' type="text/javascript"></script>
    </head>
    <body>
        <h1 id='time'></h1>
        <h2 id='date'></h2>
        <div id='weather'></div>
        
        <script>
            var noSleep;
            window.onload = function() {
                noSleep = new NoSleep();   
                document.addEventListener('click', enableNoSleep, false);
                $('body').click();
                runEverySecond();
                runEveryHalfHour();
            };
            
            function enableNoSleep() {
                noSleep.enable();
                console.log('Enabling wake lock');
                document.removeEventListener('click', enableNoSleep, false);
            }
            
            function getTime() {
                var date = new Date();
                var time = (date.getHours() > 12) ? date.getHours() - 12 : date.getHours();
                time += ":";
                time += (date.getMinutes() > 9) ? date.getMinutes() : "0" + date.getMinutes();
                return time;
            }
            
            function getDate() {
                var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                var date = new Date();
                return days[date.getDay()] + ", " + months[date.getMonth()] + " " + date.getDate();
            }
            
            function getWeather(onResponse) {
                 /*$.get('https://api.forecast.io/forecast/6bb985b59e0265149fc0e4d7159ff9b2/39.7029,-75.1118?exclude=minutely,flags&lang=en', {}, function(response) {
                        var data = JSON.parse(response);
                        return data.currently.summary + " " + data.currently.temperature + "°";
                 });*/
/*                $.ajax({
                    url: 'https://api.forecast.io/forecast/6bb985b59e0265149fc0e4d7159ff9b2/39.7029,-75.1118?exclude=minutely,flags&lang=en',
                    data: {},
                    type: 'GET',
                    crossDomain: true,
                    dataType: 'jsonp',
                    jsonpCallback: 'onResponse',
                    success: function(response) {
//                        var data = JSON.parse(response);
//                        onResponse(data.currently.summary + " " + data.currently.temperature + "°");
                    },
                    error: function() {}
                });*/
                $.getJSON('https://api.forecast.io/forecast/6bb985b59e0265149fc0e4d7159ff9b2/39.7029,-75.1118?exclude=minutely,flags&lang=en',function(json){
                  onResponse(data.currently.summary + " " + data.currently.temperature + "°");
                });
            }
            
            function runEverySecond() {
                $('#time').html(getTime());
                $('#date').html(getDate());   
            }
            
            function runEveryHalfHour() {
                getWeather(function(response) {
                    console.error(response);
                    $('#weather').html(response);
                });
            }
            
            function runEveryDay() {
            }
            
            setInterval(function() {
                runEverySecond();
            }, 1000); // Every second
            setInterval(function() {
                runEveryHalfHour();
            }, 1000 * 60 * 30); // Every half hour
            setTimeout(function() {
                runEveryDay();                
                window.location.reload();
            }, 1000 * 60 * 60 * 24); // Every 24 hours
        </script>
    </body>
</html>